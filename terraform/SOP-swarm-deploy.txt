# set up default environment configs for TF and AWS, expect errors on first run
. ./env-setup-terraform.sh

packer build -machine-readable \
packer-ubuntu-docker.json \
| tee packer-ubuntu-docker.log

terraform plan

terraform graph | dot -Tpng > graph.png

open graph.png

terraform plan \
	-target aws_instance.swarm-manager \
	-var swarm_init=true \
	-var swarm_managers=1

# deploy swarm-manager vm and initiate swarm 
terraform apply \
	-target aws_instance.swarm-manager \
	-var swarm_init=true \
	-var swarm_managers=1

# verify swarm is running
ssh -i ~/.ssh/devops21.pem \
	ubuntu@$(terraform output swarm_manager_1_public_ip) \
	docker node ls

# set up AWS and Terraform env configs
. ./env-setup-terraform.sh

# deploy remaining docker nodes to swarm
terraform apply

# verify all swarm nodes running from remote command-line
ssh -i ~/.ssh/devops21.pem \
   ubuntu@$(terraform output swarm_manager_1_public_ip) docker node ls

# install services, eg. jenkins, elk, etc
