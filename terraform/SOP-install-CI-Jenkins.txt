# install jenkins on swarm-master-1

ssh -i ~/.ssh/devops21.pem \
   ubuntu@$(terraform output swarm_manager_1_public_ip)
#mount EFS
mount -t nfs4 $(curl http://169.254.169.254/latest/meta-data/placement/availability-zone):/ /mnt/efs

mkdir -p docker/jenkins

# start rsync/lsyncd

# TODO: add docker storage replication to AWS EFS mount for backup and recovery
docker service create --name jenkins \
   -p 8082:8080 \
   -p 50000:50000 \
   -e JENKINS_OPTS="--prefix=/jenkins" \
   --mount "type=bind,source=/mnt/efs/jenkins,target=/var/jenkins_home" \
   --reserve-memory 300m \
   jenkins:2.7.4-alpine

docker service ls
